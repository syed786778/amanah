<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amanah - Secure Photo Sharing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="app"></div>
    <script>
        const SUPABASE_URL = 'https://imiljivxosyrcosznklh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltaWxqaXZ4b3N5cmNvc3pua2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMTIwOTcsImV4cCI6MjA3OTY4ODA5N30.TOgeuC3-RdG2ywIxDz2NWRhLHI4gxTkG4pilaZBqhso';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let state = {view:'home',currentAlbum:null,uploaderInfo:{name:'',email:''},photos:[],shareLink:'',otp:'',otpExpiry:null,viewerOtp:'',albumIdToView:'',isVerified:false,loading:false};
        
        function genOTP(){return Math.floor(100000+Math.random()*900000).toString()}
        function genAlbumId(){return'album_'+Math.random().toString(36).substr(2,9)}
        function formatTime(e){const r=e-Date.now(),t=Math.floor(r/36e5),n=Math.floor(r%36e5/6e4);return t+'h '+n+'m'}
        function copyText(t){navigator.clipboard.writeText(t);alert('Copied!')}
        function setupProtection(){const e=e=>{e.preventDefault();alert('Screenshots disabled')},t=e=>{if(e.key==='PrintScreen'||e.metaKey&&e.shiftKey&&(e.key==='3'||e.key==='4')){e.preventDefault();alert('Screenshots disabled')}};document.addEventListener('contextmenu',e);document.addEventListener('keydown',t)}
        
        window.addEventListener('DOMContentLoaded',()=>{const e=new URLSearchParams(window.location.search).get('album');e&&(state.albumIdToView=e,state.view='viewer');render()});
        
        function handleFiles(e){const t=Array.from(e.target.files);Promise.all(t.map(e=>new Promise(t=>{const n=new FileReader;n.onload=e=>t(e.target.result);n.readAsDataURL(e)}))).then(e=>{state.photos=[...state.photos,...e];render()})}
        
        async function upload(){if(!state.uploaderInfo.name||!state.uploaderInfo.email||!state.photos.length){alert('Please fill all fields');return}state.loading=true;render();try{const e=genAlbumId(),t=genOTP(),n=Date.now()+864e5,{data:a,error:o}=await supabase.from('albums').insert({id:e,name:state.uploaderInfo.name,email:state.uploaderInfo.email,otp:t,otp_expiry:n,created_at:Date.now()}).select().single();if(o)throw o;const{error:r}=await supabase.from('photos').insert(state.photos.map(t=>({album_id:e,photo_data:t})));if(r)throw r;const{data:s,error:i}=await supabase.from('photos').select('*').eq('album_id',e);if(i)throw i;state.currentAlbum={...a,photos:s.map(e=>e.photo_data)};state.otp=t;state.otpExpiry=n;state.shareLink=location.origin+location.pathname+'?album='+e;state.view='gallery';state.loading=false;render()}catch(e){console.error('Upload error:',e);alert('Failed to create album: '+e.message);state.loading=false;render()}}
        
        async function regenOTP(){if(!state.currentAlbum)return;state.loading=true;render();try{const e=genOTP(),t=Date.now()+864e5,{error:n}=await supabase.from('albums').update({otp:e,otp_expiry:t}).eq('id',state.currentAlbum.id);if(n)throw n;state.currentAlbum.otp=e;state.currentAlbum.otp_expiry=t;state.otp=e;state.otpExpiry=t;state.loading=false;alert('New OTP generated!');render()}catch(e){console.error('OTP error:',e);alert('Failed to regenerate OTP: '+e.message);state.loading=false;render()}}
        
        async function expireOTP(){if(!state.currentAlbum)return;if(!confirm('Expire OTP now? This will immediately block all access to your album.'))return;state.loading=true;render();try{const e=Date.now()-1000,{error:t}=await supabase.from('albums').update({otp_expiry:e}).eq('id',state.currentAlbum.id);if(t)throw t;state.currentAlbum.otp_expiry=e;state.otpExpiry=e;state.loading=false;alert('OTP expired successfully! No one can access this album now.');render()}catch(e){console.error('Expire OTP error:',e);alert('Failed to expire OTP: '+e.message);state.loading=false;render()}}
        
        async function verify(){state.loading=true;render();try{const{data:e,error:t}=await supabase.from('albums').select('*').eq('id',state.albumIdToView).single();if(t||!e){alert('Album not found');state.loading=false;render();return}if(Date.now()>e.otp_expiry){alert('OTP expired. Contact album owner.');state.loading=false;render();return}if(e.otp!==state.viewerOtp){alert('Invalid OTP');state.loading=false;render();return}const{data:n,error:a}=await supabase.from('photos').select('*').eq('album_id',state.albumIdToView).order('created_at',{ascending:true});if(a)throw a;state.currentAlbum={...e,photos:n.map(e=>e.photo_data)};state.isVerified=true;state.view='view';state.loading=false;setupProtection();render()}catch(e){console.error('Verify error:',e);alert('Failed to verify: '+e.message);state.loading=false;render()}}
        
        async function delPhoto(e){if(!confirm('Delete photo?'))return;state.loading=true;render();try{const{data:t,error:n}=await supabase.from('photos').select('id').eq('album_id',state.currentAlbum.id).order('created_at',{ascending:true});if(n)throw n;if(t.length===1){if(confirm('Last photo. Delete album?')){await delAlbum();return}else{state.loading=false;render();return}}const a=t[e],{error:o}=await supabase.from('photos').delete().eq('id',a.id);if(o)throw o;state.currentAlbum.photos=state.currentAlbum.photos.filter((t,n)=>n!==e);state.loading=false;alert('Photo deleted');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete: '+e.message);state.loading=false;render()}}
        
        async function delAlbum(){if(!confirm('Delete entire album?'))return;state.loading=true;render();try{const{error:e}=await supabase.from('albums').delete().eq('id',state.currentAlbum.id);if(e)throw e;state.view='home';state.currentAlbum=null;state.loading=false;alert('Album deleted');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete: '+e.message);state.loading=false;render()}}
        
        function nav(e){state.view=e;if(e==='home'){state.photos=[];state.uploaderInfo={name:'',email:''};state.currentAlbum=null;state.isVerified=false;state.viewerOtp='';state.albumIdToView='';window.history.pushState({},document.title,location.pathname)}render()}
        
        function renderLoading(){return'<div class="flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div><span class="ml-3">Loading...</span></div>'}
        
        function render(){
            const app=document.getElementById('app');
            if(state.view==='home'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-4xl mx-auto"><div class="text-center py-8"><svg class="w-16 h-16 text-purple-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg><h1 class="text-4xl font-bold text-gray-800 mb-2">Amanah</h1><p class="text-gray-600 mb-2">Share your precious moments with trust & security</p><p class="text-sm text-purple-600 italic mb-6">ÿ£ŸÖÿßŸÜÿ© - Trustworthy Protection</p><div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4 text-left"><p class="text-sm text-red-800 font-semibold mb-2">‚ö†Ô∏è Legal Notice & Terms of Use</p><p class="text-xs text-red-700 leading-relaxed"><strong>Cybercrime Warning:</strong> Unauthorized morphing, editing, misusing, or distributing photos from this platform is a serious criminal offense under IT Act 2000 (India), GDPR (EU), and similar laws worldwide. Violators will be prosecuted.<br/><br/><strong>User Responsibility:</strong> By using Amanah, you agree that you are solely responsible for the content you upload and share. The platform owner is not liable for any misuse, unauthorized access, or damages arising from your use of this service.<br/><br/><strong>No Warranty:</strong> This service is provided "as is" without any guarantees. While we implement security measures, we cannot guarantee absolute protection against all forms of unauthorized access or capture.<br/><br/><strong>Indemnification:</strong> You agree to indemnify and hold harmless the platform owner from any claims, damages, or legal actions arising from your use of this service.</p></div></div><div class="grid md:grid-cols-2 gap-6"><div class="bg-white rounded-lg shadow-lg p-8 hover:shadow-xl transition-shadow"><svg class="w-12 h-12 text-purple-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg><h2 class="text-2xl font-bold text-center mb-4">Upload Photos</h2><p class="text-gray-600 text-center mb-6">Share securely with OTP-protected links</p><button onclick="nav(\'upload\')" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Start Uploading</button></div><div class="bg-white rounded-lg shadow-lg p-8 hover:shadow-xl transition-shadow"><svg class="w-12 h-12 text-pink-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg><h2 class="text-2xl font-bold text-center mb-4">View Photos</h2><p class="text-gray-600 text-center mb-6">Access with album ID and OTP</p><button onclick="nav(\'viewer\')" class="w-full bg-pink-600 text-white py-3 rounded-lg hover:bg-pink-700 font-semibold">View Album</button></div></div><div class="mt-12 bg-white rounded-lg shadow-lg p-6"><h3 class="text-xl font-bold mb-4 text-center">Security Features</h3><div class="grid md:grid-cols-3 gap-4 text-center"><div class="p-4"><svg class="w-8 h-8 mx-auto mb-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg><h4 class="font-semibold mb-1">OTP Protection</h4><p class="text-sm text-gray-600">24-hour expiring OTPs</p></div><div class="p-4"><svg class="w-8 h-8 mx-auto mb-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg><h4 class="font-semibold mb-1">Screenshot Prevention</h4><p class="text-sm text-gray-600">Blocks screenshots</p></div><div class="p-4"><svg class="w-8 h-8 mx-auto mb-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/></svg><h4 class="font-semibold mb-1">Cloud Storage</h4><p class="text-sm text-gray-600">Access from any device</p></div></div></div></div></div>';
            } else if(state.view==='upload'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-2xl mx-auto"><button onclick="nav(\'home\')" class="mb-4 text-purple-600">‚Üê Back</button><div class="bg-white rounded-lg shadow-lg p-8"><h2 class="text-3xl font-bold mb-6 text-center">Upload Your Photos</h2>'+(state.loading?renderLoading():'<div class="mb-4"><label class="block text-gray-700 font-semibold mb-2">Your Name *</label><input type="text" oninput="state.uploaderInfo.name=this.value" class="w-full px-4 py-2 border rounded-lg"></div><div class="mb-4"><label class="block text-gray-700 font-semibold mb-2">Your Email *</label><input type="email" oninput="state.uploaderInfo.email=this.value" class="w-full px-4 py-2 border rounded-lg"></div><div class="mb-6"><label class="block text-gray-700 font-semibold mb-2">Upload Photos *</label><input type="file" accept="image/*" multiple onchange="handleFiles(event)" class="w-full px-4 py-2 border rounded-lg">'+(state.photos.length?'<p class="mt-2 text-sm text-gray-600">'+state.photos.length+' photo(s) selected</p>':'')+'</div>'+(state.photos.length?'<div class="mb-6 grid grid-cols-3 gap-2">'+state.photos.map(p=>'<img src="'+p+'" class="w-full h-24 object-cover rounded">').join('')+'</div>':'')+'<button onclick="upload()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Create Secure Album</button>')+'</div></div></div>';
            } else if(state.view==='gallery'){
                const exp=Date.now()>state.otpExpiry;
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-4xl mx-auto"><button onclick="nav(\'home\')" class="mb-4 text-purple-600">‚Üê Back</button><div class="bg-white rounded-lg shadow-lg p-8"><h2 class="text-3xl font-bold mb-4 text-center text-green-600">Album Created! üéâ</h2>'+(state.loading?renderLoading():'<div class="bg-purple-50 rounded-lg p-6 mb-6"><h3 class="font-bold text-lg mb-4">Share These:</h3><div class="mb-4"><label class="block text-sm font-semibold mb-1">Album ID:</label><div class="flex gap-2"><input type="text" value="'+state.currentAlbum.id+'" readonly class="flex-1 px-4 py-2 border rounded-lg"><button onclick="copyText(\''+state.currentAlbum.id+'\')" class="px-4 py-2 bg-purple-600 text-white rounded-lg">Copy</button></div></div><div class="mb-4"><label class="block text-sm font-semibold mb-1">OTP '+(exp?'<span class="text-red-600">(Expired)</span>':'')+':</label><div class="flex gap-2"><input type="text" value="'+state.otp+'" readonly class="flex-1 px-4 py-2 border rounded-lg text-2xl font-mono text-center '+(exp?'text-red-600':'')+'"><button onclick="regenOTP()" class="px-4 py-2 bg-green-600 text-white rounded-lg">Regenerate</button><button onclick="expireOTP()" class="px-4 py-2 bg-orange-600 text-white rounded-lg">Expire Now</button></div>'+(exp?'':'<p class="text-sm text-gray-600 mt-1">Expires in: '+formatTime(state.otpExpiry)+'</p>')+'</div><div class="mb-4"><label class="block text-sm font-semibold mb-1">Share Link:</label><div class="flex gap-2"><input type="text" value="'+state.shareLink+'" readonly class="flex-1 px-4 py-2 border rounded-lg text-sm"><button onclick="copyText(\''+state.shareLink+'\')" class="px-4 py-2 bg-purple-600 text-white rounded-lg">Copy</button></div></div></div><div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6"><p class="text-sm text-yellow-800"><strong>Important:</strong> Share Album ID and OTP. OTP expires in 24h or when you click "Expire Now".</p></div><div><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">Photos ('+state.currentAlbum.photos.length+'):</h3><button onclick="delAlbum()" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-semibold">Delete Album</button></div><div class="grid grid-cols-3 gap-4">'+state.currentAlbum.photos.map((p,i)=>'<div class="relative group"><img src="'+p+'" class="w-full h-32 object-cover rounded-lg"><button onclick="delPhoto('+i+')" class="absolute top-2 right-2 bg-red-600 text-white px-3 py-1 rounded-lg text-sm opacity-0 group-hover:opacity-100">Delete</button></div>').join('')+'</div></div>')+'</div></div></div>';
            } else if(state.view==='viewer'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-md mx-auto"><button onclick="nav(\'home\')" class="mb-4 text-purple-600">‚Üê Back</button><div class="bg-white rounded-lg shadow-lg p-8"><svg class="w-16 h-16 text-purple-600 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg><h2 class="text-3xl font-bold mb-6 text-center">Access Album</h2><div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6"><p class="text-xs text-red-800 leading-relaxed"><strong>‚ö†Ô∏è Legal Warning:</strong> You are accessing private content. Any unauthorized use, copying, morphing, editing, or distribution of these photos is a criminal offense under cybercrime laws (IT Act 2000, GDPR, etc.). Violators will face legal prosecution. By proceeding, you acknowledge that you have been granted authorized access and will not misuse this content.</p></div>'+(state.loading?renderLoading():'<div class="mb-4"><label class="block text-gray-700 font-semibold mb-2">Album ID *</label><input type="text" value="'+state.albumIdToView+'" oninput="state.albumIdToView=this.value" placeholder="Enter album ID" class="w-full px-4 py-2 border rounded-lg"></div><div class="mb-6"><label class="block text-gray-700 font-semibold mb-2">OTP *</label><input type="text" oninput="state.viewerOtp=this.value" placeholder="6-digit OTP" maxlength="6" class="w-full px-4 py-2 border rounded-lg text-center text-2xl font-mono"></div><button onclick="verify()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">View Photos</button><div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4"><p class="text-sm text-blue-800">Enter Album ID and OTP to view photos securely.</p></div>')+'</div></div></div>';
            } else if(state.view==='view'&&state.isVerified){
                app.innerHTML='<div class="min-h-screen bg-black p-4" style="user-select:none"><div class="max-w-6xl mx-auto"><div class="flex justify-between items-center mb-4"><button onclick="nav(\'home\')" class="text-white">‚Üê Exit</button><div class="text-white text-sm">üõ°Ô∏è Screenshot Protected</div></div><div class="bg-gray-900 rounded-lg p-6 mb-4"><h2 class="text-2xl font-bold text-white mb-2">Album by '+state.currentAlbum.name+'</h2><p class="text-gray-400 text-sm">'+state.currentAlbum.photos.length+' photos ‚Ä¢ Viewing securely</p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">'+state.currentAlbum.photos.map((p,i)=>'<div class="relative group"><img src="'+p+'" oncontextmenu="return false" draggable="false" class="w-full h-64 object-cover rounded-lg"><div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 rounded-lg"><p class="text-white text-sm">Photo '+(i+1)+'</p></div><div class="absolute inset-0 flex items-center justify-center pointer-events-none"><div class="text-white text-opacity-30 text-5xl font-bold" style="transform:rotate(-45deg);text-shadow:2px 2px 4px rgba(0,0,0,0.5)">AMANAH</div></div></div>').join('')+'</div><div class="mt-6 bg-red-900 bg-opacity-50 border border-red-600 rounded-lg p-4"><p class="text-red-200 text-sm mb-2">‚ö†Ô∏è Screenshots and downloads are disabled</p><p class="text-red-300 text-xs"><strong>Legal Warning:</strong> Unauthorized use, copying, morphing, or distribution of these photos is a criminal offense punishable under IT Act 2000 (India), GDPR (EU), and similar cybercrime laws worldwide. You will be prosecuted for violations.</p></div></div></div>';
            }
        }
        
        render();
    </script>
</body>
</html>