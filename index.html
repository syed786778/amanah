<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <meta name="description" content="Amanah - Secure marriage profile photo sharing with OTP protection by Syed Rashad">
Â  Â  <title>Amanah - Secure Photo Sharing</title>
Â  Â  
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â  
Â  Â  <style>
Â  Â  Â  Â  .card-shadow {
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-gradient-purple {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #a855f7, #9333ea);
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-gradient-purple:hover {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #9333ea, #7e22ce);
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* SECURITY: Container to hold image and canvas */
Â  Â  Â  Â  .secure-image-container {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  -webkit-user-select: none;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Watermark overlay is mostly redundant now, as canvas drawing is used for security, 
Â  Â  Â  Â  Â  Â but kept for compatibility/extra layer */
Â  Â  Â  Â  .watermark-overlay {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%) rotate(-45deg);
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  Â  Â  font-size: 3vw;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .btn-disabled {
Â  Â  Â  Â  Â  Â  background-color: #6b7280;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  Â  Â  opacity: 0.6;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* SECURITY: Instant blackout overlay for screenshot attempts */
Â  Â  Â  Â  .screenshot-block-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: #000;
Â  Â  Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .screenshot-block-overlay.active {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* HARDENED: Prevent standard browser selection/save functions globally */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  -webkit-user-select: none; 
Â  Â  Â  Â  Â  Â  -moz-user-select: none; 
Â  Â  Â  Â  Â  Â  -ms-user-select: none; 
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }
Â  Â  </style>
Â  Â  
Â  Â  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPHFTQYLE1"></script>
Â  Â  <script>
Â  Â  Â  Â  window.dataLayer = window.dataLayer || [];
Â  Â  Â  Â  function gtag(){dataLayer.push(arguments);}
Â  Â  Â  Â  gtag('js', new Date());
Â  Â  Â  Â  gtag('config', 'G-YPHFTQYLE1');
Â  Â  </script>
</head>
<body class="bg-gray-900 text-gray-200" oncopy="return false;" oncut="return false;">
Â  Â  
Â  Â  <div id="screenshot-block-overlay" class="screenshot-block-overlay">
Â  Â  Â  Â  <svg class="w-24 h-24 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
Â  Â  Â  Â  </svg>
Â  Â  Â  Â  <h2 class="text-2xl font-bold text-white mb-2">âš ï¸ Screenshot Detected</h2>
Â  Â  Â  Â  <p class="text-gray-300 text-center px-4">Screenshots are prohibited. You will be logged out shortly.</p>
Â  Â  </div>

Â  Â  <div id="app"></div>
Â  Â  
Â  Â  <script>
Â  Â  Â  Â  const SUPABASE_URL = 'https://imiljivxosyrcosznklh.supabase.co';
Â  Â  Â  Â  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltaWxqaXZ4b3N5cmNvc3pua2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMTIwOTcsImV4cCI6MjA3OTY4ODA5N30.TOgeuC3-RdG2ywIxDz2NWRhLHI4gxTkG4pilaZBqhso';
Â  Â  Â  Â  
Â  Â  Â  Â  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
Â  Â  Â  Â  
Â  Â  Â  Â  // Global State and Protection Variables
Â  Â  Â  Â  let visibilityChangeCount = 0;
Â  Â  Â  Â  let lastVisibilityChange = 0;
Â  Â  Â  Â  let protectionActive = false;

Â  Â  Â  Â  let state = {
Â  Â  Â  Â  Â  Â  view: 'home',
Â  Â  Â  Â  Â  Â  homeTab: 'upload', 
Â  Â  Â  Â  Â  Â  currentAlbum: null,
Â  Â  Â  Â  Â  Â  uploaderInfo: { name: '', email: '' },
Â  Â  Â  Â  Â  Â  photos: [],
Â  Â  Â  Â  Â  Â  shareLink: '',
Â  Â  Â  Â  Â  Â  otp: '',
Â  Â  Â  Â  Â  Â  otpExpiry: null,
Â  Â  Â  Â  Â  Â  viewerOtp: '',
Â  Â  Â  Â  Â  Â  albumIdToView: '',
Â  Â  Â  Â  Â  Â  isVerified: false,
Â  Â  Â  Â  Â  Â  loading: false,
Â  Â  Â  Â  Â  Â  lightboxIndex: null,
Â  Â  Â  Â  Â  Â  manageEmail: '',
Â  Â  Â  Â  Â  Â  termsAccepted: false,
Â  Â  Â  Â  Â  Â  screenshotAttempts: 0 
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  // --- UTILITY FUNCTIONS ---

Â  Â  Â  Â  function genOTP(){return Math.floor(100000+Math.random()*900000).toString()}
Â  Â  Â  Â  function genAlbumId(){return'album_'+Math.random().toString(36).substr(2,9)}
Â  Â  Â  Â  function formatTime(e){const r=e-Date.now(),t=Math.floor(r/36e5),n=Math.floor(r%36e5/6e4);return t+'h '+n+'m'}
Â  Â  Â  Â  
Â  Â  Â  Â  function actionCard(title, color, svgPath, text, buttonText, action) {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-700 hover:border-${color}-500 transition-all duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-8 h-8 text-${color}-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">${svgPath}</svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-white">${title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-gray-400 space-y-2 mb-6 text-sm">${text}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="${action}" class="w-full bg-${color}-600 text-white py-3 rounded-lg font-semibold transition-all duration-300 hover:bg-${color}-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Navigation and State Helpers
Â  Â  Â  Â  function nav(e){
Â  Â  Â  Â  Â  Â  protectionActive=false;
Â  Â  Â  Â  Â  Â  state.view=e;
Â  Â  Â  Â  Â  Â  if(e==='home'||e==='upload'||e==='manage'||e==='viewer'){
Â  Â  Â  Â  Â  Â  Â  Â  state.photos=[];
Â  Â  Â  Â  Â  Â  Â  Â  state.uploaderInfo={name:'',email:''};
Â  Â  Â  Â  Â  Â  Â  Â  state.currentAlbum=null;
Â  Â  Â  Â  Â  Â  Â  Â  state.isVerified=false;
Â  Â  Â  Â  Â  Â  Â  Â  state.viewerOtp='';
Â  Â  Â  Â  Â  Â  Â  Â  state.albumIdToView='';
Â  Â  Â  Â  Â  Â  Â  Â  state.lightboxIndex=null;
Â  Â  Â  Â  Â  Â  Â  Â  state.manageEmail='';
Â  Â  Â  Â  Â  Â  Â  Â  state.screenshotAttempts=0;
Â  Â  Â  Â  Â  Â  Â  Â  window.history.pushState({},document.title,location.pathname)
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  render()
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function toggleTerms(checkbox) {
Â  Â  Â  Â  Â  Â  state.termsAccepted = checkbox.checked;
Â  Â  Â  Â  Â  Â  checkUploadFormComplete(); 
Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // --- INPUT UPDATE FUNCTIONS (Non-rendering + Focus Preservation) ---
Â  Â  Â  Â  
Â  Â  Â  Â  // UPLOAD FORM INPUTS
Â  Â  Â  Â  let uploadFormComplete = false;
Â  Â  Â  Â  
Â  Â  Â  Â  function checkUploadFormComplete() {
Â  Â  Â  Â  Â  Â  const isComplete = !!state.uploaderInfo.name && !!state.uploaderInfo.email && state.photos.length > 0 && state.termsAccepted;
Â  Â  Â  Â  Â  Â  if (isComplete !== uploadFormComplete) {
Â  Â  Â  Â  Â  Â  Â  Â  uploadFormComplete = isComplete;
Â  Â  Â  Â  Â  Â  Â  Â  render(); // Only re-render when the button state *changes*
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function updateUploaderName(input) {
Â  Â  Â  Â  Â  Â  state.uploaderInfo.name = input.value;
Â  Â  Â  Â  Â  Â  checkUploadFormComplete();
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateUploaderEmail(input) {
Â  Â  Â  Â  Â  Â  state.uploaderInfo.email = input.value;
Â  Â  Â  Â  Â  Â  checkUploadFormComplete();
Â  Â  Â  Â  }

Â  Â  Â  Â  // VIEWER FORM INPUTS
Â  Â  Â  Â  let verifyFormComplete = false;
Â  Â  Â  Â  
Â  Â  Â  Â  function checkVerifyFormComplete() {
Â  Â  Â  Â  Â  Â  const isComplete = !!state.albumIdToView && !!state.viewerOtp;
Â  Â  Â  Â  Â  Â  if (isComplete !== verifyFormComplete) {
Â  Â  Â  Â  Â  Â  Â  Â  verifyFormComplete = isComplete;
Â  Â  Â  Â  Â  Â  Â  Â  render(); // Only re-render when the button state *changes*
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateAlbumId(input) {
Â  Â  Â  Â  Â  Â  state.albumIdToView = input.value;
Â  Â  Â  Â  Â  Â  checkVerifyFormComplete();
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateViewerOtp(input) {
Â  Â  Â  Â  Â  Â  state.viewerOtp = input.value;
Â  Â  Â  Â  Â  Â  checkVerifyFormComplete();
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // ** NEW FIX: MANAGE FORM INPUTS **
Â  Â  Â  Â  let manageFormComplete = false;
Â  Â  Â  Â  
Â  Â  Â  Â  function checkManageFormComplete() {
Â  Â  Â  Â  Â  Â  const isComplete = !!state.manageEmail;
Â  Â  Â  Â  Â  Â  if (isComplete !== manageFormComplete) {
Â  Â  Â  Â  Â  Â  Â  Â  manageFormComplete = isComplete;
Â  Â  Â  Â  Â  Â  Â  Â  render(); // Only re-render when the button state *changes*
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateManageEmail(input) {
Â  Â  Â  Â  Â  Â  state.manageEmail = input.value;
Â  Â  Â  Â  Â  Â  checkManageFormComplete();
Â  Â  Â  Â  }
Â  Â  Â  Â  // ** END NEW FIX **

Â  Â  Â  Â  // --- SCREENSHOT & SECURITY HANDLERS ---
Â  Â  Â  Â  
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Scrambles the canvas pixels immediately when a screenshot attempt is detected.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function scrambleCanvasPixels() {
Â  Â  Â  Â  Â  Â  const photoIndex = state.lightboxIndex !== null ? state.lightboxIndex : 0;
Â  Â  Â  Â  Â  Â  const canvas = document.getElementById(`secure-photo-${photoIndex}`);
Â  Â  Â  Â  Â  Â  if (!canvas) return;

Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Create a completely black or white overlay, which is faster and more effective than scrambling
Â  Â  Â  Â  Â  Â  ctx.fillStyle = Math.random() > 0.5 ? 'rgba(0,0,0,1)' : 'rgba(255,255,255,1)'; 
Â  Â  Â  Â  Â  Â  ctx.fillRect(0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Add massive distortion text on top
Â  Â  Â  Â  Â  Â  ctx.save();
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
Â  Â  Â  Â  Â  Â  ctx.font = 'bold 300px Arial'; 
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  Â  Â  ctx.textBaseline = 'middle';
Â  Â  Â  Â  Â  Â  ctx.fillText('ACCESS DENIED', canvas.width / 2, canvas.height / 2);
Â  Â  Â  Â  Â  Â  ctx.restore();

Â  Â  Â  Â  Â  Â  console.log('âš¡ Canvas Scrambled!');
Â  Â  Â  Â  }


Â  Â  Â  Â  function handleScreenshotAttempt() {
Â  Â  Â  Â  Â  Â  state.screenshotAttempts++;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 1. Immediately scramble the image data
Â  Â  Â  Â  Â  Â  scrambleCanvasPixels();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const overlay = document.getElementById('screenshot-block-overlay');
Â  Â  Â  Â  Â  Â  if (overlay) {
Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  console.warn('Screenshot attempt detected:', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  album: state.currentAlbum?.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attemptNumber: state.screenshotAttempts
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // 2. Aggressive logout after scrambling
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nav('home');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('You have been logged out due to unauthorized screen capture attempt. This incident has been logged.');
Â  Â  Â  Â  Â  Â  Â  Â  }, 1000); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function showScreenshotWarning() {
Â  Â  Â  Â  Â  Â  alert('âš ï¸ Screenshots and screen recording are strictly prohibited!\n\nThis action has been logged and may result in restricted access.');
Â  Â  Â  Â  Â  Â  state.screenshotAttempts++;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (state.screenshotAttempts >= 2) { 
Â  Â  Â  Â  Â  Â  Â  Â  handleScreenshotAttempt();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function setupProtection() {
Â  Â  Â  Â  Â  Â  if (protectionActive) return;
Â  Â  Â  Â  Â  Â  protectionActive = true;

Â  Â  Â  Â  Â  Â  const viewerContent = document.getElementById('viewer-content-area');
Â  Â  Â  Â  Â  Â  const overlay = document.getElementById('screenshot-block-overlay');
Â  Â  Â  Â  Â  Â  if (!viewerContent || !overlay) return;

Â  Â  Â  Â  Â  Â  console.log('ğŸ”’ Enhanced protection activated');

Â  Â  Â  Â  Â  Â  // 1. Desktop protection
Â  Â  Â  Â  Â  Â  const contextMenuBlocker = e => { 
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); 
Â  Â  Â  Â  Â  Â  Â  Â  showScreenshotWarning();
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const keyBlocker = e => {
Â  Â  Â  Â  Â  Â  Â  Â  // Block: F12, PrintScreen, Cmd+Shift+3/4/5 (Mac screenshots), Ctrl+P (print)
Â  Â  Â  Â  Â  Â  Â  Â  if (e.keyCode === 123 || e.key === 'PrintScreen' || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (e.metaKey && e.shiftKey && (e.key === '3' || e.key === '4' || e.key === '5')) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (e.ctrlKey && e.key === 'p')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleScreenshotAttempt(); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  document.addEventListener('contextmenu', contextMenuBlocker);
Â  Â  Â  Â  Â  Â  document.addEventListener('keydown', keyBlocker);

Â  Â  Â  Â  Â  Â  // 2. Mobile Screenshot Detection via Visibility API (Retained for robustness)
Â  Â  Â  Â  Â  Â  const handleVisibilityChange = () => {
Â  Â  Â  Â  Â  Â  Â  Â  const now = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  const timeSinceLastChange = now - lastVisibilityChange;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (document.visibilityState === 'hidden') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (timeSinceLastChange < 1500 && timeSinceLastChange > 50) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  visibilityChangeCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (visibilityChangeCount >= 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleScreenshotAttempt();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  visibilityChangeCount = 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastVisibilityChange = now;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (document.visibilityState === 'visible') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { visibilityChangeCount = 0; }, 3000); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  document.addEventListener('visibilitychange', handleVisibilityChange);

Â  Â  Â  Â  Â  Â  // 3. HARDENED: Page blur/focus detection (Most reliable mobile quick-block/screenshot utility detection)
Â  Â  Â  Â  Â  Â  let blurStartTime = 0;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  window.addEventListener('blur', () => {
Â  Â  Â  Â  Â  Â  Â  Â  blurStartTime = Date.now();
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  window.addEventListener('focus', () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (blurStartTime > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const blurDuration = Date.now() - blurStartTime;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If blur duration is very short (screenshot utility), scramble and log out
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (blurDuration < 500 && blurDuration > 50) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleScreenshotAttempt(); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blurStartTime = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // --- CANVAS RENDERING (Image Protection & Enhanced Watermark) ---
Â  Â  Â  Â  
Â  Â  Â  Â  function drawPhotoOnCanvas(canvasId, photoData, watermarkText) {
Â  Â  Â  Â  Â  Â  const canvas = document.getElementById(canvasId);
Â  Â  Â  Â  Â  Â  if (!canvas) return;

Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  img.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  // Set canvas size to match the image ratio
Â  Â  Â  Â  Â  Â  Â  Â  const ratio = img.height / img.width;
Â  Â  Â  Â  Â  Â  Â  Â  const canvasWidth = canvas.clientWidth;
Â  Â  Â  Â  Â  Â  Â  Â  const canvasHeight = canvasWidth * ratio;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = img.width;
Â  Â  Â  Â  Â  Â  Â  Â  canvas.height = img.height;
Â  Â  Â  Â  Â  Â  Â  Â  canvas.style.height = `${canvasHeight}px`;

Â  Â  Â  Â  Â  Â  Â  Â  // 1. Draw the actual photo
Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(img, 0, 0, img.width, img.height);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Draw the SUBTLE Watermark (Enhanced Visibility)
Â  Â  Â  Â  Â  Â  Â  Â  ctx.save();
Â  Â  Â  Â  Â  Â  Â  Â  ctx.globalAlpha = 0.15; // Increased opacity
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'white';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Dynamically size the watermark based on canvas width (make it massive)
Â  Â  Â  Â  Â  Â  Â  Â  const watermarkSize = Math.max(250, canvas.width / 8);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.font = `bold ${watermarkSize}px Arial`; 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  Â  Â  Â  Â  ctx.textBaseline = 'middle';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Calculate position for a single, large, central watermark
Â  Â  Â  Â  Â  Â  Â  Â  const centerX = canvas.width / 2;
Â  Â  Â  Â  Â  Â  Â  Â  const centerY = canvas.height / 2;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Rotate by -45 degrees
Â  Â  Â  Â  Â  Â  Â  Â  ctx.translate(centerX, centerY);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.rotate(-45 * Math.PI / 180);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Draw the main text
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillText(watermarkText || 'Amanah Secured', 0, 0);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Draw a secondary, slightly darker shadow text (for greater visibility on light areas)
Â  Â  Â  Â  Â  Â  Â  Â  ctx.globalAlpha = 0.10; 
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'black';
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillText(watermarkText || 'Amanah Secured', 5, 5);

Â  Â  Â  Â  Â  Â  Â  Â  ctx.restore();
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  img.src = photoData;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- PHOTO & ALBUM DATA HANDLERS (Retained Supabase logic) ---

Â  Â  Â  Â  function createShareMessage() {
Â  Â  Â  Â  Â  Â  const albumName = state.currentAlbum ? state.currentAlbum.name : 'Secured Photos';
Â  Â  Â  Â  Â  Â  const link = state.shareLink;
Â  Â  Â  Â  Â  Â  const otp = state.otp;
Â  Â  Â  Â  Â  Â  return `*--- Amanah Secure Photo Share ---*\nHello, here is the link to view the photo album for *${albumName}*.\n\nğŸ”’ *Album Access Details:*\n- *Share Link:* ${link}\n- *One-Time Passcode (OTP):* ${otp}\n\n*Instructions:* Tap the link, then enter the OTP to view the secured photos. The access is valid for 24 hours.\n\nRegards,\n${state.currentAlbum.name}`.trim();
Â  Â  Â  Â  }

Â  Â  Â  Â  function copyText() {
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(createShareMessage());
Â  Â  Â  Â  Â  Â  alert('Shareable link & OTP copied to clipboard!');
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function copyOtp() {
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(state.otp);
Â  Â  Â  Â  Â  Â  alert('OTP copied to clipboard!');
Â  Â  Â  Â  }

Â  Â  Â  Â  function copyLink() {
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(state.shareLink);
Â  Â  Â  Â  Â  Â  alert('Shareable link copied to clipboard!');
Â  Â  Â  Â  }

Â  Â  Â  Â  function shareViaWhatsApp() {
Â  Â  Â  Â  Â  Â  const message = createShareMessage();
Â  Â  Â  Â  Â  Â  const encodedMessage = encodeURIComponent(message);
Â  Â  Â  Â  Â  Â  window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
Â  Â  Â  Â  }

Â  Â  Â  Â  function openLightbox(index){state.lightboxIndex=index;render();setTimeout(setupProtection,100);}
Â  Â  Â  Â  function closeLightbox(){state.lightboxIndex=null;render();}
Â  Â  Â  Â  function nextPhoto(){if(state.lightboxIndex<state.currentAlbum.photos.length-1){state.lightboxIndex++;render();setTimeout(setupProtection,100);}}
Â  Â  Â  Â  function prevPhoto(){if(state.lightboxIndex>0){state.lightboxIndex--;render();setTimeout(setupProtection,100);}}
Â  Â  Â  Â  
Â  Â  Â  Â  function handleFiles(e){
Â  Â  Â  Â  Â  Â  const t=Array.from(e.target.files);
Â  Â  Â  Â  Â  Â  Promise.all(t.map(e=>new Promise(t=>{
Â  Â  Â  Â  Â  Â  Â  Â  const n=new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  n.onload=e=>t(e.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  n.readAsDataURL(e)
Â  Â  Â  Â  Â  Â  }))).then(e=>{
Â  Â  Â  Â  Â  Â  Â  Â  // Only take a maximum of 10 photos
Â  Â  Â  Â  Â  Â  Â  Â  state.photos=[...state.photos,...e].slice(0, 10);
Â  Â  Â  Â  Â  Â  Â  Â  checkUploadFormComplete(); // Check after file change
Â  Â  Â  Â  Â  Â  Â  Â  render()
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  async function manageAlbum(){ 
Â  Â  Â  Â  Â  Â  if(!state.manageEmail){alert('Please enter your email');return}state.loading=true;render();try{const{data:albums,error}=await supabase.from('albums').select('*').eq('email',state.manageEmail.trim().toLowerCase());if(error)throw error;if(!albums||albums.length===0){alert('No albums found with this email address.');state.loading=false;render();return}const album=albums[0];const{data:photos}=await supabase.from('photos').select('*').eq('album_id',album.id).order('created_at',{ascending:true});state.currentAlbum={...album,photos:photos.map(p=>p.photo_data)};state.otp=album.otp;state.otpExpiry=album.otp_expiry;state.shareLink=location.origin+location.pathname+'?album='+album.id;state.view='gallery';state.loading=false;render()}catch(e){console.error('Manage error:',e);alert('Failed to load albums: '+e.message);state.loading=false;render()}}
Â  Â  Â  Â  
Â  Â  Â  Â  async function upload(){
Â  Â  Â  Â  Â  Â  if (!state.termsAccepted) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('You must accept the Terms & Conditions before creating an album.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(!state.uploaderInfo.name||!state.uploaderInfo.email||!state.photos.length){alert('Please fill all required fields and upload at least one photo');return}state.loading=true;render();try{const e=genAlbumId(),t=genOTP(),n=Date.now()+864e5,{data:a,error:o}=await supabase.from('albums').insert({id:e,name:state.uploaderInfo.name,email:state.uploaderInfo.email.trim().toLowerCase(),otp:t,otp_expiry:n,created_at:Date.now()}).select().single();if(o)throw o;const{error:r}=await supabase.from('photos').insert(state.photos.map(t=>({album_id:e,photo_data:t})));if(r)throw r;const{data:s,error:i}=await supabase.from('photos').select('*').eq('album_id',e).order('created_at',{ascending:true});if(i)throw i;state.currentAlbum={...a,photos:s.map(e=>e.photo_data)};state.otp=t;state.otpExpiry=n;state.shareLink=location.origin+location.pathname+'?album='+e;state.view='gallery';state.loading=false;render()}catch(e){console.error('Upload error:',e);alert('Failed to create album: '+e.message);state.loading=false;render()}}

Â  Â  Â  Â  async function regenOTP(){
Â  Â  Â  Â  Â  Â  if(!state.currentAlbum)return;
Â  Â  Â  Â  Â  Â  state.loading=true;
Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  Â  Â  Â  const e=genOTP();
Â  Â  Â  Â  Â  Â  Â  Â  const t=Date.now()+864e5; 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const {error:n}=await supabase.from('albums').update({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  otp:e,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  otp_expiry:t
Â  Â  Â  Â  Â  Â  Â  Â  }).eq('id',state.currentAlbum.id);

Â  Â  Â  Â  Â  Â  Â  Â  if(n)throw n;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  state.currentAlbum.otp=e;
Â  Â  Â  Â  Â  Â  Â  Â  state.otp=e;
Â  Â  Â  Â  Â  Â  Â  Â  state.otpExpiry=t;
Â  Â  Â  Â  Â  Â  Â  Â  state.loading=false;
Â  Â  Â  Â  Â  Â  Â  Â  alert('New OTP generated successfully! Access is now valid for the next 24 hours.');
Â  Â  Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  }catch(e){
Â  Â  Â  Â  Â  Â  Â  Â  console.error('OTP error:',e);
Â  Â  Â  Â  Â  Â  Â  Â  alert('Failed to regenerate OTP: '+e.message);
Â  Â  Â  Â  Â  Â  Â  Â  state.loading=false;
Â  Â  Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  async function expireOTP(){
Â  Â  Â  Â  Â  Â  if(!state.currentAlbum)return;if(!confirm('Expire OTP now? This will immediately block all access to your album.'))return;state.loading=true;render();try{const e=Date.now()-1000,{error:t}=await supabase.from('albums').update({otp_expiry:e}).eq('id',state.currentAlbum.id);if(t)throw t;state.currentAlbum.otp_expiry=e;state.otpExpiry=e;state.loading=false;alert('OTP expired successfully! No one can access this album now.');render()}catch(e){console.error('Expire OTP error:',e);alert('Failed to expire OTP: '+e.message);state.loading=false;render()}}
Â  Â  Â  Â  
Â  Â  Â  Â  async function verify(){
Â  Â  Â  Â  Â  Â  // Verify logic runs after all input is gathered
Â  Â  Â  Â  Â  Â  if(!state.albumIdToView||!state.viewerOtp){alert('Please enter both Album ID and OTP');return}state.loading=true;render();try{const{data:e,error:t}=await supabase.from('albums').select('*').eq('id',state.albumIdToView).single();if(t||!e){alert('Album not found. Please check your Album ID.');state.loading=false;render();return}if(Date.now()>e.otp_expiry){alert('OTP has expired. Please contact the album owner to regenerate it.');state.loading=false;render();return}if(e.otp!==state.viewerOtp){alert('Invalid OTP. Please check and try again.');state.loading=false;render();return}const{data:n,error:a}=await supabase.from('photos').select('*').eq('album_id',state.albumIdToView).order('created_at',{ascending:true});if(a)throw a;state.currentAlbum={...e,photos:n.map(e=>e.photo_data)};state.isVerified=true;state.view='view';state.loading=false;render();setTimeout(setupProtection,100);}catch(e){console.error('Verify error:',e);alert('Failed to verify album: '+e.message);state.loading=false;render()}}
Â  Â  Â  Â  
Â  Â  Â  Â  async function delPhoto(e){
Â  Â  Â  Â  Â  Â  if(!confirm('Are you sure you want to delete this photo?'))return;state.loading=true;render();try{const{data:t,error:n}=await supabase.from('photos').select('id').eq('album_id',state.currentAlbum.id).order('created_at',{ascending:true});if(n)throw n;if(t.length===1){if(confirm('This is the last photo. Delete the entire album?')){await delAlbum();return}else{state.loading=false;render();return}}const a=t[e],{error:o}=await supabase.from('photos').delete().eq('id',a.id);if(o)throw o;state.currentAlbum.photos=state.currentAlbum.photos.filter((t,n)=>n!==e);state.loading=false;alert('Photo deleted successfully');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete photo: '+e.message);state.loading=false;render()}}
Â  Â  Â  Â  
Â  Â  Â  Â  async function delAlbum(){
Â  Â  Â  Â  Â  Â  if(!confirm('Are you sure you want to delete this entire album? This action cannot be undone.'))return;state.loading=true;render();try{const{error:e}=await supabase.from('albums').delete().eq('id',state.currentAlbum.id);if(e)throw e;state.view='home';state.currentAlbum=null;state.loading=false;alert('Album deleted successfully');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete album: '+e.message);state.loading=false;render()}}


Â  Â  Â  Â  // --- RENDERING FUNCTIONS ---

Â  Â  Â  Â  function renderHeader() {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <header class="bg-gray-800 shadow-lg sticky top-0 z-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center h-16">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="nav('home'); return false;" class="text-3xl font-extrabold text-white tracking-tight flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-purple-400">Amanah</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6 ml-1 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav class="space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="nav('home'); return false;" class="${state.view === 'home' ? 'text-white border-b-2 border-purple-500' : 'text-gray-400 hover:text-white'} text-sm font-medium transition-colors duration-200">Home</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="nav('viewer'); return false;" class="${state.view === 'viewer' ? 'text-white border-b-2 border-purple-500' : 'text-gray-400 hover:text-white'} text-sm font-medium transition-colors duration-200">Viewer</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="nav('manage'); return false;" class="${state.view === 'manage' ? 'text-white border-b-2 border-purple-500' : 'text-gray-400 hover:text-white'} text-sm font-medium transition-colors duration-200">Manage</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </header>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderHome() {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main class="max-w-4xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold text-white sm:text-5xl mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Secure Photo Sharing <span class="text-purple-400">by Amanah</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl text-gray-400">Share with confidence. View with trust.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${actionCard(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'ğŸ”’ Create & Share Album',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'purple',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Upload photos, generate a secure, time-bound link and a one-time passcode (OTP) for highly controlled viewing.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Get Started',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "nav('upload')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${actionCard(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'ğŸ‘ï¸ View Secured Photos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'blue',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Access an album using the unique album ID and a valid OTP from the sender. Screenshots are strictly prevented.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'View Photos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "nav('viewer')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${actionCard(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'âš™ï¸ Manage Albums',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'green',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Â <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065z"/> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Access your uploaded album using your email to revoke access, regenerate the OTP, delete photos, or delete the entire album.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Manage Access',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "nav('manage')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderUpload() {
Â  Â  Â  Â  Â  Â  // Check if the upload button should be enabled
Â  Â  Â  Â  Â  Â  const uploadButtonClasses = uploadFormComplete
Â  Â  Â  Â  Â  Â  Â  Â  ? 'btn-gradient-purple text-white py-3 px-6 rounded-lg font-semibold shadow-lg'
Â  Â  Â  Â  Â  Â  Â  Â  : 'btn-disabled text-gray-400 py-3 px-6 rounded-lg font-semibold';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main class="max-w-4xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-white mb-8 border-b border-gray-700 pb-2">Create Secure Album</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl space-y-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-semibold text-purple-400 mb-4 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Your Album Details
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="Your Name (e.g., Syed Rashad)" oninput="updateUploaderName(this)" value="${state.uploaderInfo.name}" class="p-3 bg-gray-700 text-white border border-gray-600 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" placeholder="Your Email (for management access)" oninput="updateUploaderEmail(this)" value="${state.uploaderInfo.email}" class="p-3 bg-gray-700 text-white border border-gray-600 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-semibold text-purple-400 mb-4 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Upload Photos (${state.photos.length}/10)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500 mb-3">Max 10 images (JPEG/PNG) - converted to Base64 for secure, serverless storage.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" onchange="handleFiles(event)" accept="image/jpeg, image/png" multiple class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100" ${state.photos.length >= 10 ? 'disabled' : ''}>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-6 grid grid-cols-3 sm:grid-cols-5 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.photos.map((photo, index) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative group aspect-square rounded-lg overflow-hidden border border-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${photo}" alt="Preview ${index + 1}" class="w-full h-full object-cover">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section class="border-t border-gray-700 pt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="terms-accept" onchange="toggleTerms(this)" ${state.termsAccepted ? 'checked' : ''} class="mt-1 w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="terms-accept" class="ml-3 text-sm text-gray-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  I have read and agree to the <a href="#" onclick="nav('terms'); return false;" class="text-purple-400 hover:text-purple-300 underline font-medium">Terms & Conditions</a>.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="${uploadFormComplete ? 'upload()' : ''}" class="w-full mt-6 ${uploadButtonClasses}" ${!uploadFormComplete || state.loading ? 'disabled' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.loading ? 'Creating Album...' : 'Create Secure Album and Get Share Link'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderViewer() {
Â  Â  Â  Â  Â  Â  const verifyButtonClasses = verifyFormComplete
Â  Â  Â  Â  Â  Â  Â  Â  ? 'btn-gradient-purple text-white py-3 px-6 rounded-lg font-semibold shadow-lg'
Â  Â  Â  Â  Â  Â  Â  Â  : 'btn-disabled text-gray-400 py-3 px-6 rounded-lg font-semibold';

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main class="max-w-xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-white mb-8 border-b border-gray-700 pb-2">View Secured Album</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-400">Album ID (from the share link)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="e.g., album_xyz123abc" oninput="updateAlbumId(this)" value="${state.albumIdToView}" class="p-3 w-full bg-gray-700 text-white border border-gray-600 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-400">One-Time Passcode (OTP)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="e.g., 654321" oninput="updateViewerOtp(this)" value="${state.viewerOtp}" maxlength="6" class="p-3 w-full bg-gray-700 text-white border border-gray-600 rounded-lg text-center text-xl tracking-widest focus:ring-purple-500 focus:border-purple-500" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="${verifyFormComplete ? 'verify()' : ''}" class="w-full mt-4 ${verifyButtonClasses}" ${!verifyFormComplete || state.loading ? 'disabled' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.loading ? 'Verifying Access...' : 'Verify & View Album'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-center text-gray-500 pt-2">Photos are protected by screen capture prevention measures.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderManage() {
Â  Â  Â  Â  Â  Â  const manageButtonClasses = manageFormComplete
Â  Â  Â  Â  Â  Â  Â  Â  ? 'btn-gradient-purple text-white py-3 px-6 rounded-lg font-semibold shadow-lg'
Â  Â  Â  Â  Â  Â  Â  Â  : 'btn-disabled text-gray-400 py-3 px-6 rounded-lg font-semibold';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main class="max-w-xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-white mb-8 border-b border-gray-700 pb-2">Manage Your Albums</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-400">Email Address (Used to create the album)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" placeholder="Your Email" oninput="updateManageEmail(this)" value="${state.manageEmail}" class="p-3 w-full bg-gray-700 text-white border border-gray-600 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="${manageFormComplete ? 'manageAlbum()' : ''}" class="w-full mt-4 ${manageButtonClasses}" ${!manageFormComplete || state.loading ? 'disabled' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.loading ? 'Loading Albums...' : 'Search for My Album'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-center text-gray-500 pt-6">The system can only pull the last album associated with the email address for management.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderGallery() {
Â  Â  Â  Â  Â  Â  if (!state.currentAlbum) return '';
Â  Â  Â  Â  Â  Â  const isExpired = Date.now() > state.otpExpiry;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main class="max-w-6xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="nav('manage')" class="text-purple-400 hover:text-purple-300 flex items-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Back to Manage
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-white mb-3">Album: ${state.currentAlbum.name}'s Photos</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 mb-8">Access is managed by ${state.currentAlbum.email}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl space-y-6 mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-semibold text-purple-400 border-b border-gray-700 pb-2 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.799-2.753 9.385l-1.38 2.035C8.985 24.385 15.015 24.385 16.133 22.42l-1.38-2.035C14.009 17.799 13 14.517 13 11V11zM12 3a9 9 0 019 9c0 3.517-1.009 6.799-2.753 9.385l-1.38 2.035C15.015 24.385 8.985 24.385 7.867 22.42l-1.38-2.035C4.009 17.799 3 14.517 3 11a9 9 0 019-9z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Access Control
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-400">Album Share Link</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" value="${state.shareLink}" readonly class="flex-grow p-3 bg-gray-700 text-white border border-gray-600 rounded-l-lg text-sm truncate" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="copyLink()" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-r-lg flex-shrink-0">Copy</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-400">One-Time Passcode (OTP)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" value="${state.otp}" readonly class="flex-grow p-3 bg-gray-700 text-white border border-gray-600 rounded-l-lg text-xl text-center tracking-widest" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="copyOtp()" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-r-lg flex-shrink-0">Copy</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm text-center pt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="${isExpired ? 'text-red-400 font-bold' : 'text-green-400'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”‘ Access ${isExpired ? 'EXPIRED' : 'expires in ' + formatTime(state.otpExpiry)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row gap-4 pt-4 border-t border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="regenOTP()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Regenerate New OTP (24h)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="expireOTP()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-colors duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Expire OTP Now (Revoke Access)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="shareViaWhatsApp()" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-3 rounded-lg font-semibold transition-colors duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Share via WhatsApp
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pt-4 border-t border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="delAlbum()" class="w-full bg-gray-600 hover:bg-gray-700 text-red-300 py-3 rounded-lg font-semibold transition-colors duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âš ï¸ Permanently Delete Album (and all photos)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.currentAlbum.photos.map((photo, index) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative group cursor-pointer border-4 border-gray-700 rounded-lg overflow-hidden transition-all duration-300 hover:border-purple-500 hover:shadow-xl" onclick="openLightbox(${index})">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${photo}" alt="Photo ${index + 1}" class="w-full h-full object-cover aspect-square">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white font-bold mb-2">View Photo</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="event.stopPropagation(); delPhoto(${index})" class="text-red-400 hover:text-red-300 text-sm p-1 rounded-full bg-gray-900 bg-opacity-75">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderView() {
Â  Â  Â  Â  Â  Â  if (!state.currentAlbum || !state.isVerified) return nav('viewer');

Â  Â  Â  Â  Â  Â  // Watermark text should be dynamic, using sender's name for traceability
Â  Â  Â  Â  Â  Â  const watermarkText = state.currentAlbum.name; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // The canvas wrapper is essential for preventing right-click/download on the image data
Â  Â  Â  Â  Â  Â  const canvasElement = `<canvas id="secure-photo-0" class="w-full h-auto object-contain max-h-[80vh] rounded-lg shadow-2xl"></canvas>`;

Â  Â  Â  Â  Â  Â  // Note: The drawing logic is called via setTimeout in render(), after the element exists.
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main id="viewer-content-area" class="max-w-4xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="nav('viewer')" class="text-purple-400 hover:text-purple-300 flex items-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Close Album View
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-white mb-2">Viewing: ${state.currentAlbum.name}'s Photos</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-400 text-lg font-semibold mb-6">âš ï¸ STRICTLY NO SCREENSHOTS OR RECORDING. Violation will result in permanent restriction.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="secure-image-container w-full bg-gray-800 rounded-lg p-4 flex justify-center items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${canvasElement}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-8 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.currentAlbum.photos.length > 1 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 text-sm mb-4">Click below to see other photos in the album.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.currentAlbum.photos.map((_, index) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openLightbox(${index})" class="w-16 h-16 rounded-lg ${state.lightboxIndex === index || (state.lightboxIndex === null && index === 0) ? 'border-4 border-purple-500 shadow-lg' : 'border border-gray-600'} overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${state.currentAlbum.photos[index]}" alt="Thumbnail ${index + 1}" class="w-full h-full object-cover opacity-50"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `<p class="text-gray-500">This album contains one photo.</p>`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderLightbox() {
Â  Â  Â  Â  Â  Â  if (state.lightboxIndex === null || !state.currentAlbum) return '';

Â  Â  Â  Â  Â  Â  const photoIndex = state.lightboxIndex;
Â  Â  Â  Â  Â  Â  const totalPhotos = state.currentAlbum.photos.length;
Â  Â  Â  Â  Â  Â  const currentPhotoData = state.currentAlbum.photos[photoIndex];
Â  Â  Â  Â  Â  Â  const watermarkText = state.currentAlbum.name; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // The canvas is the primary image container
Â  Â  Â  Â  Â  Â  const canvasElement = `<canvas id="secure-photo-${photoIndex}" class="w-full h-auto object-contain max-h-[90vh] rounded-lg shadow-2xl"></canvas>`;

Â  Â  Â  Â  Â  Â  // Note: The drawing logic is called via setTimeout in render(), after the element exists.
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="viewer-content-area" class="fixed inset-0 bg-black bg-opacity-95 z-[9990] flex items-center justify-center p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative w-full max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="secure-image-container w-full flex justify-center items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${canvasElement}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white hover:text-red-400 z-[9992] bg-gray-800 p-3 rounded-full shadow-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${photoIndex > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="prevPhoto()" class="absolute left-0 top-1/2 transform -translate-y-1/2 p-4 bg-gray-800 bg-opacity-70 text-white rounded-r-lg hover:bg-opacity-90 transition-opacity z-[9992]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${photoIndex < totalPhotos - 1 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="nextPhoto()" class="absolute right-0 top-1/2 transform -translate-y-1/2 p-4 bg-gray-800 bg-opacity-70 text-white rounded-l-lg hover:bg-opacity-90 transition-opacity z-[9992]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-center bg-gray-900 bg-opacity-70 px-4 py-2 rounded-full text-sm z-[9991]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Photo ${photoIndex + 1} of ${totalPhotos} - Shared by ${state.currentAlbum.name}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderTerms() {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <main class="max-w-4xl mx-auto px-4 py-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold text-white mb-8 border-b border-purple-500 pb-3">Terms & Conditions â€“ Amanah</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl space-y-6 text-gray-300 leading-relaxed">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-4 mb-2">1. Purpose and Scope</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Amanah (â€œPlatformâ€) is designed exclusively for the secure and controlled sharing of private matrimonial profile photos. The Platform acts only as a technology facilitator. Ownership of all uploaded images remains solely with the photo sender. By accessing or using Amanah, you agree to comply with and be bound by these Terms & Conditions.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">2. Consent, Ownership, and Usage</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Users must upload only photos they own or have explicit permission to share.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Uploading, sharing, or accessing any image without lawful consent is strictly prohibited.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>The sender retains full rights to revoke access or delete shared content at any time.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-red-400 mt-6 mb-2">3. Strict No Screenshot / Recording / Download Policy</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Screenshots, screen recordings, photo downloads, photography using external devices, or any other form of unauthorized capture of images displayed on the Platform is strictly prohibited.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>The Platform employs technical and behavioral safeguards to deter and detect such unauthorized activities.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Any detected or suspected attempt may result in immediate termination of access, notification to the sender, and permanent restriction from the Platform.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">4. Data Security and Access Controls</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Photos are stored as encoded data (Base64) within a secure Supabase infrastructure.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Access is provided through time-bound, single-use links protected by One-Time Passcodes (OTP).</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Amanah does not guarantee absolute security against all external threats but implements reasonable and industry-aligned safeguards.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">5. Data Retention and DeletionÂ </h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Photos remain accessible only for the duration defined by the sender.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>The sender may delete albums or revoke access at any time.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Upon deletion, Amanah does not retain copies of the images on its servers beyond standard system backups.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">6. User ResponsibilitiesÂ </h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Users agree to:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Use the Platform only for lawful matrimonial purposes.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Respect privacy, dignity, and consent at all times.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Refrain from misusing, redistributing, reproducing, or exploiting any content accessed through Amanah.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 font-semibold text-red-300">Any misuse or violation constitutes a breach of trust (Amanah) and may lead to suspension or permanent termination of access.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">7. Indemnity and Limitation of Liability</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-gray-200">Users agree to fully indemnify and hold harmless Amanah, its owner, founder, operators, and affiliates from any claims, losses, damages, legal proceedings, penalties, or expenses arising out of:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Unauthorized sharing, misuse, or capture of images</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Breach of these Terms & Conditions</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Violation of any applicable law, privacy right, or third-party right</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4 font-semibold text-gray-200">Amanah and its owner shall not be liable for:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Actions taken by users outside the Platformâ€™s technical controls</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Misuse of images through external devices or third-party applications</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Any indirect, incidental, or consequential damages</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">8. Platform Role Disclaimer</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-gray-200">Amanah is a neutral technology platform and does not:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Verify the identity, intent, or conduct of users</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Act as a matrimony broker, agent, or intermediary</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Take responsibility for interpersonal disputes or misuse beyond reasonable technical safeguards</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">9. Enforcement and Cooperation</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-gray-200">Amanah reserves the right to:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc ml-6 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Restrict, suspend, or terminate user access without prior notice for violations</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Cooperate with lawful authorities when required by law</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Share relevant access logs or incident information with the photo sender where appropriate</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-purple-400 mt-6 mb-2">10. Governing Law and Jurisdiction</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>These Terms & Conditions shall be governed by and construed in accordance with the laws of India. Any disputes shall be subject to the exclusive jurisdiction of courts in Bengaluru, India.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-green-400 mt-6 mb-2">11. Acceptance</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>By continuing to use Amanah, you acknowledge that you have read, understood, and agreed to these Terms & Conditions in full.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pt-8 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="nav('home')" class="bg-purple-600 hover:bg-purple-700 text-white py-3 px-8 rounded-lg font-semibold transition-colors duration-200 shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Back to Home
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderFooter(){ 
Â  Â  Â  Â  Â  Â  // UPDATED FOOTER CONTENT AND STRUCTURE
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <footer class="bg-gray-900 border-t border-gray-700 text-gray-500 mt-16">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 py-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-4 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold mb-4 text-purple-400 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  About Amanah
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-400 mb-3 leading-relaxed">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Amanah is a secure, closed platform for sharing matrimony photos â€” built to prevent uncontrolled forwarding, misuse, and endless circulation. Every photo is shared with clear consent, control, and accountability, so it reaches only the intended recipient.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Rooted in the values of trust, dignity, and responsible usage, Amanah enables intentional photo sharing where the sender remains in control at all times.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500 leading-relaxed mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Amanah is founded by Syed, a Bangalore-based startup enthusiast with hands-on experience in building customer-first, compliant systems. Shaped by personal experience and real-world gaps, Amanah is a founder-led initiative focused on building trust-first products that solve problems that truly matter.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold mb-4 text-purple-400">Legal & Security</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="space-y-2 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="text-red-400 font-semibold">âš ï¸ Cybercrime Warning</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><a href="#" onclick="nav('terms'); return false;" class="text-purple-300 hover:text-purple-100 underline">Terms & Conditions</a></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 text-center text-xs text-gray-600 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â© ${new Date().getFullYear()} Amanah. All Rights Reserved. Built with trust by Syed.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </footer>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function render() {
Â  Â  Â  Â  Â  Â  const app = document.getElementById('app');
Â  Â  Â  Â  Â  Â  let content = renderHeader();

Â  Â  Â  Â  Â  Â  switch (state.view) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'home':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderHome();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'upload':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderUpload();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'viewer':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderViewer();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'manage':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderManage();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'gallery':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderGallery();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'view':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderView();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'lightbox':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderLightbox();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'terms': // NEW CASE FOR TERMS AND CONDITIONS
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += renderTerms();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (state.view !== 'lightbox') {
Â  Â  Â  Â  Â  Â  Â  Â  content += renderFooter();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  app.innerHTML = content;

Â  Â  Â  Â  Â  Â  // Post-render DOM manipulation for canvas drawing
Â  Â  Â  Â  Â  Â  if (state.view === 'view' || state.view === 'lightbox') {
Â  Â  Â  Â  Â  Â  Â  Â  const photoIndex = state.view === 'lightbox' ? state.lightboxIndex : 0;
Â  Â  Â  Â  Â  Â  Â  Â  const canvasId = `secure-photo-${photoIndex}`;
Â  Â  Â  Â  Â  Â  Â  Â  const photoData = state.currentAlbum.photos[photoIndex];
Â  Â  Â  Â  Â  Â  Â  Â  const watermarkText = state.currentAlbum.name; 
Â  Â  Â  Â  Â  Â  Â  Â  drawPhotoOnCanvas(canvasId, photoData, watermarkText);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // Initial load logic
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  const albumId = urlParams.get('album');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (albumId) {
Â  Â  Â  Â  Â  Â  Â  Â  state.albumIdToView = albumId;
Â  Â  Â  Â  Â  Â  Â  Â  state.view = 'viewer';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  state.view = 'home';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
