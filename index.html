<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Amanah - Secure marriage profile photo sharing with OTP protection by Syed Rashad">
    <title>Amanah - Secure Photo Sharing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="app"></div>
    <script>
        const SUPABASE_URL = 'https://imiljivxosyrcosznklh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltaWxqaXZ4b3N5cmNvc3pua2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMTIwOTcsImV4cCI6MjA3OTY4ODA5N30.TOgeuC3-RdG2ywIxDz2NWRhLHI4gxTkG4pilaZBqhso';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let state = {view:'home',currentAlbum:null,uploaderInfo:{name:'',email:''},photos:[],shareLink:'',otp:'',otpExpiry:null,viewerOtp:'',albumIdToView:'',isVerified:false,loading:false,lightboxIndex:null,manageEmail:''};
        
        function genOTP(){return Math.floor(100000+Math.random()*900000).toString()}
        function genAlbumId(){return'album_'+Math.random().toString(36).substr(2,9)}
        function formatTime(e){const r=e-Date.now(),t=Math.floor(r/36e5),n=Math.floor(r%36e5/6e4);return t+'h '+n+'m'}
        function copyText(t){navigator.clipboard.writeText(t);alert('Copied to clipboard!')}
        function setupProtection(){const e=e=>{e.preventDefault();alert('Screenshots disabled for security')},t=e=>{if(e.key==='PrintScreen'||e.metaKey&&e.shiftKey&&(e.key==='3'||e.key==='4')){e.preventDefault();alert('Screenshots disabled for security')}};document.addEventListener('contextmenu',e);document.addEventListener('keydown',t)}
        
        function openLightbox(index){state.lightboxIndex=index;render()}
        function closeLightbox(){state.lightboxIndex=null;render()}
        function nextPhoto(){if(state.lightboxIndex<state.currentAlbum.photos.length-1){state.lightboxIndex++;render()}}
        function prevPhoto(){if(state.lightboxIndex>0){state.lightboxIndex--;render()}}
        
        async function manageAlbum(){if(!state.manageEmail){alert('Please enter your email');return}state.loading=true;render();try{const{data:albums,error}=await supabase.from('albums').select('*').eq('email',state.manageEmail.trim().toLowerCase());if(error)throw error;if(!albums||albums.length===0){alert('No albums found with this email address.');state.loading=false;render();return}if(albums.length===1){const album=albums[0];const{data:photos,error:photoError}=await supabase.from('photos').select('*').eq('album_id',album.id).order('created_at',{ascending:true});if(photoError)throw photoError;state.currentAlbum={...album,photos:photos.map(p=>p.photo_data)};state.otp=album.otp;state.otpExpiry=album.otp_expiry;state.shareLink=location.origin+location.pathname+'?album='+album.id;state.view='gallery';state.loading=false;render()}else{state.loading=false;alert('Multiple albums found. Select one:');const albumList=albums.map((a,i)=>`${i+1}. Album ID: ${a.id} (Created: ${new Date(a.created_at).toLocaleDateString()})`).join('\n');const selection=prompt(albumList+'\n\nEnter number (1-'+albums.length+'):');if(selection){const idx=parseInt(selection)-1;if(idx>=0&&idx<albums.length){const album=albums[idx];const{data:photos,error:photoError}=await supabase.from('photos').select('*').eq('album_id',album.id).order('created_at',{ascending:true});if(photoError)throw photoError;state.currentAlbum={...album,photos:photos.map(p=>p.photo_data)};state.otp=album.otp;state.otpExpiry=album.otp_expiry;state.shareLink=location.origin+location.pathname+'?album='+album.id;state.view='gallery';render()}else{alert('Invalid selection')}}}}catch(e){console.error('Manage error:',e);alert('Failed to load albums: '+e.message);state.loading=false;render()}}
        
        window.addEventListener('DOMContentLoaded',()=>{const e=new URLSearchParams(window.location.search).get('album');e&&(state.albumIdToView=e,state.view='viewer');render()});
        
        function handleFiles(e){const t=Array.from(e.target.files);Promise.all(t.map(e=>new Promise(t=>{const n=new FileReader();n.onload=e=>t(e.target.result);n.readAsDataURL(e)}))).then(e=>{state.photos=[...state.photos,...e];render()})}
        
        async function upload(){if(!state.uploaderInfo.name||!state.uploaderInfo.email||!state.photos.length){alert('Please fill all required fields and upload at least one photo');return}state.loading=true;render();try{const e=genAlbumId(),t=genOTP(),n=Date.now()+864e5,{data:a,error:o}=await supabase.from('albums').insert({id:e,name:state.uploaderInfo.name,email:state.uploaderInfo.email.trim().toLowerCase(),otp:t,otp_expiry:n,created_at:Date.now()}).select().single();if(o)throw o;const{error:r}=await supabase.from('photos').insert(state.photos.map(t=>({album_id:e,photo_data:t})));if(r)throw r;const{data:s,error:i}=await supabase.from('photos').select('*').eq('album_id',e);if(i)throw i;state.currentAlbum={...a,photos:s.map(e=>e.photo_data)};state.otp=t;state.otpExpiry=n;state.shareLink=location.origin+location.pathname+'?album='+e;state.view='gallery';state.loading=false;render()}catch(e){console.error('Upload error:',e);alert('Failed to create album: '+e.message);state.loading=false;render()}}
        
        async function regenOTP(){if(!state.currentAlbum)return;state.loading=true;render();try{const e=genOTP(),t=Date.now()+864e5,{error:n}=await supabase.from('albums').update({otp:e,otp_expiry:t}).eq('id',state.currentAlbum.id);if(n)throw n;state.currentAlbum.otp=e;state.currentAlbum.otp_expiry=t;state.otp=e;state.otpExpiry=t;state.loading=false;alert('New OTP generated successfully!');render()}catch(e){console.error('OTP error:',e);alert('Failed to regenerate OTP: '+e.message);state.loading=false;render()}}
        
        async function expireOTP(){if(!state.currentAlbum)return;if(!confirm('Expire OTP now? This will immediately block all access to your album.'))return;state.loading=true;render();try{const e=Date.now()-1000,{error:t}=await supabase.from('albums').update({otp_expiry:e}).eq('id',state.currentAlbum.id);if(t)throw t;state.currentAlbum.otp_expiry=e;state.otpExpiry=e;state.loading=false;alert('OTP expired successfully! No one can access this album now.');render()}catch(e){console.error('Expire OTP error:',e);alert('Failed to expire OTP: '+e.message);state.loading=false;render()}}
        
        async function verify(){if(!state.albumIdToView||!state.viewerOtp){alert('Please enter both Album ID and OTP');return}state.loading=true;render();try{const{data:e,error:t}=await supabase.from('albums').select('*').eq('id',state.albumIdToView).single();if(t||!e){alert('Album not found. Please check your Album ID.');state.loading=false;render();return}if(Date.now()>e.otp_expiry){alert('OTP has expired. Please contact the album owner to regenerate it.');state.loading=false;render();return}if(e.otp!==state.viewerOtp){alert('Invalid OTP. Please check and try again.');state.loading=false;render();return}const{data:n,error:a}=await supabase.from('photos').select('*').eq('album_id',state.albumIdToView).order('created_at',{ascending:true});if(a)throw a;state.currentAlbum={...e,photos:n.map(e=>e.photo_data)};state.isVerified=true;state.view='view';state.loading=false;setupProtection();render()}catch(e){console.error('Verify error:',e);alert('Failed to verify album: '+e.message);state.loading=false;render()}}
        
        async function delPhoto(e){if(!confirm('Are you sure you want to delete this photo?'))return;state.loading=true;render();try{const{data:t,error:n}=await supabase.from('photos').select('id').eq('album_id',state.currentAlbum.id).order('created_at',{ascending:true});if(n)throw n;if(t.length===1){if(confirm('This is the last photo. Delete the entire album?')){await delAlbum();return}else{state.loading=false;render();return}}const a=t[e],{error:o}=await supabase.from('photos').delete().eq('id',a.id);if(o)throw o;state.currentAlbum.photos=state.currentAlbum.photos.filter((t,n)=>n!==e);state.loading=false;alert('Photo deleted successfully');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete photo: '+e.message);state.loading=false;render()}}
        
        async function delAlbum(){if(!confirm('Are you sure you want to delete this entire album? This action cannot be undone.'))return;state.loading=true;render();try{const{error:e}=await supabase.from('albums').delete().eq('id',state.currentAlbum.id);if(e)throw e;state.view='home';state.currentAlbum=null;state.loading=false;alert('Album deleted successfully');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete album: '+e.message);state.loading=false;render()}}
        
        function nav(e){state.view=e;if(e==='home'){state.photos=[];state.uploaderInfo={name:'',email:''};state.currentAlbum=null;state.isVerified=false;state.viewerOtp='';state.albumIdToView='';state.lightboxIndex=null;state.manageEmail='';window.history.pushState({},document.title,location.pathname)}render()}
        
        function renderLoading(){return'<div class="flex items-center justify-center py-8"><div class="animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600"></div><span class="ml-3 text-gray-700 text-lg">Loading...</span></div>'}
        
        function renderFooter(){return'<footer class="bg-gradient-to-br from-gray-900 to-gray-800 text-white mt-16"><div class="max-w-7xl mx-auto px-6 py-12"><div class="grid md:grid-cols-3 gap-10"><div><h3 class="text-xl font-bold mb-4 text-purple-400">About Amanah</h3><p class="text-sm text-gray-300 leading-relaxed mb-3">Created by <strong>Syed Rashad</strong>, Amanah was born from personal experience with the challenges of sharing marriage profile photos in today\'s digital age.</p><p class="text-sm text-gray-300 leading-relaxed">In an era where personal data misuse is rampant and photos can be easily forwarded, screenshotted, or morphed, I realized the need for a secure platform that gives photo owners complete control. Amanah ensures your precious moments remain protected while sharing them confidently with intended recipients.</p></div><div><h3 class="text-xl font-bold mb-4 text-purple-400">Legal & Privacy</h3><p class="text-xs text-gray-400 leading-relaxed"><strong class="text-red-400">⚠️ Cybercrime Warning:</strong> Unauthorized morphing, editing, misusing, or distributing photos from this platform is a criminal offense under:<br/>• IT Act 2000 (India)<br/>• GDPR (European Union)<br/>• Similar laws worldwide<br/><br/><strong>Disclaimer:</strong> This service is provided "as is" without warranties. Users are solely responsible for content uploaded. The platform owner is not liable for misuse or unauthorized access. By using Amanah, you indemnify the platform owner from all claims.</p></div><div><h3 class="text-xl font-bold mb-4 text-purple-400">Contact & Support</h3><p class="text-sm text-gray-300 mb-3">For questions or support:</p><a href="mailto:help.amanahapp@gmail.com" class="text-purple-400 hover:text-purple-300 transition-colors text-sm font-medium">help.amanahapp@gmail.com</a><p class="text-sm text-gray-400 mt-6">© 2024 Amanah by Syed Rashad<br/>أمانة - Trustworthy Protection</p></div></div><div class="border-t border-gray-700 mt-8 pt-6 text-center text-xs text-gray-500">Made with care to protect your privacy in the digital age</div></div></footer>'}
        
        function render(){
            const app=document.getElementById('app');
            if(state.view==='home'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50"><div class="max-w-7xl mx-auto px-6 py-12"><div class="text-center mb-16"><div class="inline-block"><svg class="w-20 h-20 text-purple-600 mx-auto mb-6 drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg><h1 class="text-6xl font-extrabold text-gray-900 mb-4 tracking-tight">Amanah</h1><p class="text-2xl text-purple-600 font-semibold italic mb-4">أمانة - Trustworthy Protection</p><div class="max-w-3xl mx-auto mt-6"><p class="text-lg text-gray-700 leading-relaxed mb-3">Secure marriage profile photo sharing with complete control. Born from the real need to protect personal photos in an era of digital misuse, Amanah gives you the power to share confidently while maintaining full ownership and security.</p><p class="text-md text-gray-600">Created by <span class="font-semibold text-purple-700">Syed Rashad</span> to solve the challenges of sharing sensitive photos in modern matchmaking.</p></div></div></div><div class="grid lg:grid-cols-3 gap-8 mb-16"><div class="bg-white rounded-2xl shadow-2xl p-8 hover:shadow-3xl transition-all duration-300 border border-purple-100"><div class="flex items-center mb-6"><div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 mr-4 shadow-lg"><svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg></div><h2 class="text-2xl font-bold text-gray-900">Upload Photos</h2></div><div class="space-y-4 mb-8"><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">1</span><p class="text-gray-700 leading-relaxed">Enter your name and email address</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">2</span><p class="text-gray-700 leading-relaxed">Upload multiple marriage profile photos securely</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">3</span><p class="text-gray-700 leading-relaxed">Get unique Album ID, OTP, and shareable link</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">4</span><p class="text-gray-700 leading-relaxed">Share credentials with intended recipients only</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">5</span><p class="text-gray-700 leading-relaxed">Manage access: regenerate OTP, expire, or delete anytime</p></div></div><button onclick="nav(\'upload\')" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white py-4 rounded-xl hover:from-purple-700 hover:to-purple-800 font-bold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Start Uploading</button></div><div class="bg-white rounded-2xl shadow-2xl p-8 hover:shadow-3xl transition-all duration-300 border border-orange-100"><div class="flex items-center mb-6"><div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-4 mr-4 shadow-lg"><svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div><h2 class="text-2xl font-bold text-gray-900">Manage Album</h2></div><div class="space-y-4 mb-8"><div class="flex items-start"><span class="bg-orange-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">1</span><p class="text-gray-700 leading-relaxed">Enter your registered email address</p></div><div class="flex items-start"><span class="bg-orange-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">2</span><p class="text-gray-700 leading-relaxed">Access your album management dashboard</p></div><div class="flex items-start"><span class="bg-orange-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">3</span><p class="text-gray-700 leading-relaxed">Regenerate OTP, expire access instantly, or delete photos</p></div><div class="flex items-start"><span class="bg-orange-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">4</span><p class="text-gray-700 leading-relaxed">Full control over all your shared content</p></div></div><button onclick="nav(\'manage\')" class="w-full bg-gradient-to-r from-orange-600 to-orange-700 text-white py-4 rounded-xl hover:from-orange-700 hover:to-orange-800 font-bold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Manage Album</button></div><div class="bg-white rounded-2xl shadow-2xl p-8 hover:shadow-3xl transition-all duration-300 border border-pink-100"><div class="flex items-center mb-6"><div class="bg-gradient-to-br from-pink-500 to-pink-600 rounded-2xl p-4 mr-4 shadow-lg"><svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg></div><h2 class="text-2xl font-bold text-gray-900">View Photos</h2></div><div class="space-y-4 mb-8"><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">1</span><p class="text-gray-700 leading-relaxed">Receive Album ID and OTP from photo owner</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">2</span><p class="text-gray-700 leading-relaxed">Click shared link or visit this website</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">3</span><p class="text-gray-700 leading-relaxed">Enter Album ID and 6-digit OTP provided</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">4</span><p class="text-gray-700 leading-relaxed">View photos with screenshot protection enabled</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold flex-shrink-0 mr-3 mt-0.5 shadow">5</span><p class="text-gray-700 leading-relaxed"><strong class="text-red-600">OTP expires in 24 hours</strong> - Never share access</p></div></div><button onclick="nav(\'viewer\')" class="w-full bg-gradient-to-r from-pink-600 to-pink-700 text-white py-4 rounded-xl hover:from-pink-700 hover:to-pink-800 font-bold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">View with OTP</button></div></div><div class="bg-white rounded-2xl shadow-2xl p-10"><h3 class="text-3xl font-bold mb-8 text-center text-gray-900">Why Choose Amanah?</h3><div class="grid md:grid-cols-4 gap-8"><div class="text-center"><div class="bg-purple-100 rounded-2xl p-4 inline-block mb-4"><svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg></div><h4 class="font-bold text-lg mb-2 text-gray-900">OTP Security</h4><p class="text-sm text-gray-600 leading-relaxed">24-hour expiring OTPs with instant revoke option</p></div><div class="text-center"><div class="bg-purple-100 rounded-2xl p-4 inline-block mb-4"><svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg></div><h4 class="font-bold text-lg mb-2 text-gray-900">Screenshot Block</h4><p class="text-sm text-gray-600 leading-relaxed">Advanced protection against screenshots and recording</p></div><div class="text-center"><div class="bg-purple-100 rounded-2xl p-4 inline-block mb-4"><svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/></svg></div><h4 class="font-bold text-lg mb-2 text-gray-900">Cloud Storage</h4><p class="text-sm text-gray-600 leading-relaxed">Access securely from any device, anywhere</p></div><div class="text-center"><div class="bg-purple-100 rounded-2xl p-4 inline-block mb-4"><svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15