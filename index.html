<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amanah - Secure Photo Sharing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="app"></div>
    <script>
        const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let state = {view:'home',currentAlbum:null,uploaderInfo:{name:'',email:''},photos:[],shareLink:'',otp:'',otpExpiry:null,viewerOtp:'',albumIdToView:'',isVerified:false,loading:false};
        
        function genOTP(){return Math.floor(100000+Math.random()*900000).toString()}
        function genAlbumId(){return'album_'+Math.random().toString(36).substr(2,9)}
        function formatTime(e){const r=e-Date.now(),t=Math.floor(r/36e5),n=Math.floor(r%36e5/6e4);return t+'h '+n+'m'}
        function copyText(t){navigator.clipboard.writeText(t);alert('Copied!')}
        function setupProtection(){const e=e=>{e.preventDefault();alert('Screenshots disabled')},t=e=>{if(e.key==='PrintScreen'||e.metaKey&&e.shiftKey&&(e.key==='3'||e.key==='4')){e.preventDefault();alert('Screenshots disabled')}};document.addEventListener('contextmenu',e);document.addEventListener('keydown',t)}
        
        window.addEventListener('DOMContentLoaded',()=>{const e=new URLSearchParams(window.location.search).get('album');e&&(state.albumIdToView=e,state.view='viewer');render()});
        
        function handleFiles(e){const t=Array.from(e.target.files);Promise.all(t.map(e=>new Promise(t=>{const n=new FileReader;n.onload=e=>t(e.target.result);n.readAsDataURL(e)}))).then(e=>{state.photos=[...state.photos,...e];render()})}
        
        async function upload(){if(!state.uploaderInfo.name||!state.uploaderInfo.email||!state.photos.length){alert('Please fill all fields');return}state.loading=true;render();try{const e=genAlbumId(),t=genOTP(),n=Date.now()+864e5,{data:a,error:o}=await supabase.from('albums').insert({id:e,name:state.uploaderInfo.name,email:state.uploaderInfo.email,otp:t,otp_expiry:n,created_at:Date.now()}).select().single();if(o)throw o;const{error:r}=await supabase.from('photos').insert(state.photos.map(t=>({album_id:e,photo_data:t})));if(r)throw r;const{data:s,error:i}=await supabase.from('photos').select('*').eq('album_id',e);if(i)throw i;state.currentAlbum={...a,photos:s.map(e=>e.photo_data)};state.otp=t;state.otpExpiry=n;state.shareLink=location.origin+location.pathname+'?album='+e;state.view='gallery';state.loading=false;render()}catch(e){console.error('Upload error:',e);alert('Failed to create album: '+e.message);state.loading=false;render()}}
        
        async function regenOTP(){if(!state.currentAlbum)return;state.loading=true;render();try{const e=genOTP(),t=Date.now()+864e5,{error:n}=await supabase.from('albums').update({otp:e,otp_expiry:t}).eq('id',state.currentAlbum.id);if(n)throw n;state.currentAlbum.otp=e;state.currentAlbum.otp_expiry=t;state.otp=e;state.otpExpiry=t;state.loading=false;alert('New OTP generated!');render()}catch(e){console.error('OTP error:',e);alert('Failed to regenerate OTP: '+e.message);state.loading=false;render()}}
        
        async function expireOTP(){if(!state.currentAlbum)return;if(!confirm('Expire OTP now? This will immediately block all access to your album.'))return;state.loading=true;render();try{const e=Date.now()-1000,{error:t}=await supabase.from('albums').update({otp_expiry:e}).eq('id',state.currentAlbum.id);if(t)throw t;state.currentAlbum.otp_expiry=e;state.otpExpiry=e;state.loading=false;alert('OTP expired successfully!');render()}catch(e){console.error('Expire OTP error:',e);alert('Failed to expire OTP: '+e.message);state.loading=false;render()}}
        
        async function verify(){state.loading=true;render();try{const{data:e,error:t}=await supabase.from('albums').select('*').eq('id',state.albumIdToView).single();if(t||!e){alert('Album not found');state.loading=false;render();return}if(Date.now()>e.otp_expiry){alert('OTP expired. Contact album owner.');state.loading=false;render();return}if(e.otp!==state.viewerOtp){alert('Invalid OTP');state.loading=false;render();return}const{data:n,error:a}=await supabase.from('photos').select('*').eq('album_id',state.albumIdToView).order('created_at',{ascending:true});if(a)throw a;state.currentAlbum={...e,photos:n.map(e=>e.photo_data)};state.isVerified=true;state.view='view';state.loading=false;setupProtection();render()}catch(e){console.error('Verify error:',e);alert('Failed to verify: '+e.message);state.loading=false;render()}}
        
        async function delPhoto(e){if(!confirm('Delete photo?'))return;state.loading=true;render();try{const{data:t,error:n}=await supabase.from('photos').select('id').eq('album_id',state.currentAlbum.id).order('created_at',{ascending:true});if(n)throw n;if(t.length===1){if(confirm('Last photo. Delete album?')){await delAlbum();return}else{state.loading=false;render();return}}const a=t[e],{error:o}=await supabase.from('photos').delete().eq('id',a.id);if(o)throw o;state.currentAlbum.photos=state.currentAlbum.photos.filter((t,n)=>n!==e);state.loading=false;alert('Photo deleted');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete: '+e.message);state.loading=false;render()}}
        
        async function delAlbum(){if(!confirm('Delete entire album?'))return;state.loading=true;render();try{const{error:e}=await supabase.from('albums').delete().eq('id',state.currentAlbum.id);if(e)throw e;state.view='home';state.currentAlbum=null;state.loading=false;alert('Album deleted');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete: '+e.message);state.loading=false;render()}}
        
        function nav(e){state.view=e;if(e==='home'){state.photos=[];state.uploaderInfo={name:'',email:''};state.currentAlbum=null;state.isVerified=false;state.viewerOtp='';state.albumIdToView='';window.history.pushState({},document.title,location.pathname)}render()}
        
        function renderLoading(){return'<div class="flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div><span class="ml-3">Loading...</span></div>'}
        
        function renderFooter(){return'<footer class="bg-gray-900 text-white mt-12"><div class="max-w-6xl mx-auto px-4 py-8"><div class="grid md:grid-cols-3 gap-8"><div><h3 class="text-lg font-bold mb-4 text-purple-400">About Amanah</h3><p class="text-sm text-gray-300 mb-3">Created by <strong>Syed Rashad</strong>, Amanah was born from personal experience with the challenges of sharing marriage profile photos in today\'s digital age.</p><p class="text-sm text-gray-300">In an era where personal data misuse is rampant and photos can be easily forwarded, screenshotted, or morphed, I realized the need for a secure platform that gives photo owners complete control. Amanah ensures your precious moments remain protected while sharing them confidently with intended recipients.</p></div><div><h3 class="text-lg font-bold mb-4 text-purple-400">Legal & Privacy</h3><p class="text-xs text-gray-400 leading-relaxed"><strong class="text-red-400">‚ö†Ô∏è Cybercrime Warning:</strong> Unauthorized morphing, editing, misusing, or distributing photos from this platform is a criminal offense under:<br/>‚Ä¢ IT Act 2000 (India)<br/>‚Ä¢ GDPR (European Union)<br/>‚Ä¢ Similar laws worldwide<br/><br/><strong>Disclaimer:</strong> This service is provided "as is" without warranties. Users are solely responsible for content uploaded. The platform owner is not liable for misuse or unauthorized access. By using Amanah, you indemnify the platform owner from all claims.</p></div><div><h3 class="text-lg font-bold mb-4 text-purple-400">Contact & Support</h3><p class="text-sm text-gray-300 mb-2">For questions or support:</p><p class="text-sm text-gray-400">Email: support@amanah.com</p><p class="text-sm text-gray-400 mt-4">¬© 2024 Amanah by Syed Rashad<br/>ÿ£ŸÖÿßŸÜÿ© - Trustworthy Protection</p></div></div><div class="border-t border-gray-700 mt-6 pt-6 text-center text-xs text-gray-500">Made with care to protect your privacy in the digital age</div></div></footer>'}
        
        function render(){
            const app=document.getElementById('app');
            if(state.view==='home'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50"><div class="max-w-6xl mx-auto p-4"><div class="text-center py-8"><svg class="w-16 h-16 text-purple-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg><h1 class="text-5xl font-bold text-gray-800 mb-3">Amanah</h1><p class="text-xl text-gray-600 mb-2">Secure Marriage Profile Photo Sharing</p><p class="text-lg text-purple-600 italic">ÿ£ŸÖÿßŸÜÿ© - Trustworthy Protection</p></div><div class="grid md:grid-cols-2 gap-8 mb-12"><div class="bg-white rounded-xl shadow-xl p-8"><div class="flex items-center mb-6"><div class="bg-purple-100 rounded-full p-3 mr-4"><svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg></div><h2 class="text-2xl font-bold">For Photo Uploaders</h2></div><div class="space-y-3 mb-6"><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">1</span><p class="text-gray-700">Enter your name and email address</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">2</span><p class="text-gray-700">Upload your marriage profile photos (supports multiple photos)</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">3</span><p class="text-gray-700">Receive a unique Album ID, OTP, and shareable link</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">4</span><p class="text-gray-700">Share the Album ID and OTP with intended recipients (family, prospects)</p></div><div class="flex items-start"><span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">5</span><p class="text-gray-700">Manage your album: Regenerate OTP, expire access instantly, or delete photos anytime</p></div></div><button onclick="nav(\'upload\')" class="w-full bg-purple-600 text-white py-4 rounded-lg hover:bg-purple-700 font-bold text-lg transition-all">Start Uploading Photos</button></div><div class="bg-white rounded-xl shadow-xl p-8"><div class="flex items-center mb-6"><div class="bg-pink-100 rounded-full p-3 mr-4"><svg class="w-8 h-8 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg></div><h2 class="text-2xl font-bold">For Photo Viewers</h2></div><div class="space-y-3 mb-6"><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">1</span><p class="text-gray-700">Receive Album ID and OTP from the photo owner (via WhatsApp, SMS, etc.)</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">2</span><p class="text-gray-700">Click on the shared link or visit this website</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">3</span><p class="text-gray-700">Enter the Album ID and 6-digit OTP provided to you</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">4</span><p class="text-gray-700">View photos securely with screenshot protection enabled</p></div><div class="flex items-start"><span class="bg-pink-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3 mt-1">5</span><p class="text-gray-700"><strong class="text-red-600">Important:</strong> OTP expires in 24 hours. Do not share access with others.</p></div></div><button onclick="nav(\'viewer\')" class="w-full bg-pink-600 text-white py-4 rounded-lg hover:bg-pink-700 font-bold text-lg transition-all">View Photos with OTP</button></div></div><div class="bg-white rounded-xl shadow-xl p-8"><h3 class="text-2xl font-bold mb-6 text-center">Why Choose Amanah?</h3><div class="grid md:grid-cols-4 gap-6"><div class="text-center"><svg class="w-12 h-12 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg><h4 class="font-bold mb-2">OTP Security</h4><p class="text-sm text-gray-600">24-hour expiring OTPs with instant expire option</p></div><div class="text-center"><svg class="w-12 h-12 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg><h4 class="font-bold mb-2">Screenshot Block</h4><p class="text-sm text-gray-600">Prevents screenshots and screen recording</p></div><div class="text-center"><svg class="w-12 h-12 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/></svg><h4 class="font-bold mb-2">Cloud Storage</h4><p class="text-sm text-gray-600">Access from any device, anywhere</p></div><div class="text-center"><svg class="w-12 h-12 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg><h4 class="font-bold mb-2">Owner Control</h4><p class="text-sm text-gray-600">Full control over who accesses your photos</p></div></div></div></div>'+renderFooter()+'</div>';
            } else if(state.view==='upload'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-2xl mx-auto"><button onclick="nav(\'home\')" class="mb-4 text-purple-600 hover:text-purple-700 font-semibold">‚Üê Back to Home</button><div class="bg-white rounded-lg shadow-lg p-8"><h2 class="text-3xl font-bold mb-6 text-center">Upload Your Photos</h2>'+(state.loading?renderLoading():'<div class="mb-4"><label class="block text-gray-700 font-semibold mb-2">Your Name *</label><input type="text" oninput="state.uploaderInfo.name=this.value" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"></div><div class="mb-4"><label class="block text-gray-700 font-semibold mb-2">Your Email *</label><input type="email" oninput="state.uploaderInfo.email=this.value" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"></div><div class="mb-6"><label class="block text-gray-700 font-semibold mb-2">Upload Photos *</label><input type="file" accept="image/*" multiple onchange="handleFiles(event)" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">'+(state.photos.length?'<p class="mt-2 text-sm text-gray-600">'+state.photos.length+' photo(s) selected</p>':'')+'</div>'+(state.photos.length?'<div class="mb-6 grid grid-cols-3 gap-2">'+state.photos.map(p=>'<img src="'+p+'" class="w-full h-24 object-cover rounded">').join('')+'</div>':'')+'<button onclick="upload()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Create Secure Album</button>')+'</div></div>'+renderFooter()+'</div>';
            } else if(state.view==='gallery'){
                const exp=Date.now()>state.otpExpiry;
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-4xl mx-auto"><button onclick="nav(\'home\')" class="mb-4 text-purple-600 hover:text-purple-700 font-semibold">‚Üê Back to Home</button><div class="bg-white rounded-lg shadow-lg p-8"><h2 class="text-3xl font-bold mb-4 text-center text-green-600">Album Created Successfully! üéâ</h2>'+(state.loading?renderLoading():'<div class="bg-purple-50 rounded-lg p-6 mb-6"><h3 class="font-bold text-lg mb-4">Share These Details:</h3><div class="mb-4"><label class="block text-sm font-semibold mb-1">Album ID:</label><div class="flex gap-2"><input type="text" value="'+state.currentAlbum.id+'" readonly class="flex-1 px-4 py-2 border rounded-lg"><button onclick="copyText(\''+state.currentAlbum.id+'\')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Copy</button></div></div><div class="mb-4"><label class="block text-sm font-semibold mb-1">OTP '+(exp?'<span class="text-red-600">(Expired)</span>':'')+':</label><div class="flex gap-2"><input type="text" value="'+state.otp+'" readonly class="flex-1 px-4 py-2 border rounded-lg text-2xl font-mono text-center '+(exp?'text-red-600':'')+'"><button onclick="regenOTP()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Regenerate</button><button onclick="expireOTP()" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">Expire Now</button></div>'+(exp?'':'<p class="text-sm text-gray-600 mt-1">Expires in: '+formatTime(state.otpExpiry)+'</p>')+'</div><div class="mb-4"><label class="block text-sm font-semibold mb-1">Share Link:</label><div class="flex gap-2"><input type="text" value="'+state.shareLink+'" readonly class="flex-1 px-4 py-2 border rounded-lg text-sm"><button onclick="copyText(\''+state.shareLink+'\')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Copy</button></div></div></div><div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6"><p class="text-sm text-yellow-800"><strong>Important:</strong> Share Album ID and OTP separately for maximum security. OTP expires in 24h or when you click "Expire Now".</p></div><div><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">Your Photos ('+state.currentAlbum.photos.length+'):</h3><button onclick="delAlbum()" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-semibold hover:bg-red-700">Delete Entire Album</button></div><div class="grid grid-cols-3 gap-4">'+state.currentAlbum.photos.map((p,i)=>'<div class="relative group"><img src="'+p+'" class="w-full h-32 object-cover rounded-lg"><button onclick="delPhoto('+i+')" class="absolute top-2 right-2 bg-red-600 text-white px-3 py-1 rounded-lg text-sm opacity-0 group-hover:opacity-100 hover:bg-red-700">Delete</button></div>').join('')+'</div></div>')+'</div></div>'+renderFooter()+'</div>';
            } else if(state.view==='viewer'){
                app.innerHTML='<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4"><div class="max-w-md mx-auto"><button onclick="nav(\'home\')" class="mb-4 text-purple-600 hover:text-purple-700 font-semibold">‚Üê Back to Home</button><div class="bg-white rounded-lg shadow-lg p-8"><svg class="w-16 h-16 text-purple-600 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg><h2 class="text-3xl font-bold mb-6 text-center">Access Album</h2><div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6"><p class="text-xs text-red-800 leading-relaxed"><strong>‚ö†Ô∏è Legal Warning:</strong> You are accessing private content. Any unauthorized use, copying, morphing, editing, or distribution of these photos is a criminal offense under cybercrime laws (IT Act 2000, GDPR, etc.). Violators will face legal prosecution. By proceeding, you acknowledge authorized access only.</p></div>'+(state.loading?renderLoading():'<div class="mb-4"><label class="block text-gray-700 font-semibold mb-2">Album ID *</label><input type="text" value="'+state.albumIdToView+'" oninput="state.albumIdToView=this.value" placeholder="Enter album ID" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"></div><div class="mb-6"><label class="block text-gray-700 font-semibold mb-2">OTP *</label><input type="text" oninput="state.viewerOtp=this.value" placeholder="Enter 6-digit OTP" maxlength="6" class="w-full px-4 py-2 border rounded-lg text-center text-2xl font-mono focus:outline-none focus:ring-2 focus:ring-purple-600"></div><button onclick="verify()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">View Photos Securely</button><div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4"><p class="text-sm text-blue-800">Enter the Album ID and OTP shared with you by the photo